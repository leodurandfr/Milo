# ALSA Configuration for Milo with CamillaDSP
# Audio routing with DSP processing via CamillaDSP

pcm.!default {
    type plug
    slave.pcm {
        type hw
        card sndrpihifiberry
        device 0
    }
}

ctl.!default {
    type hw
    card sndrpihifiberry
}

# === Dynamic aliases (with MILO_MODE and MILO_EQUALIZER environment variables) ===

pcm.milo_spotify {
    @func concat
    strings [
        "pcm.milo_spotify_"
        { @func getenv vars [ MILO_MODE ] default "direct" }
        { @func getenv vars [ MILO_EQUALIZER ] default "" }
    ]
}

pcm.milo_bluetooth {
    @func concat
    strings [
        "pcm.milo_bluetooth_"
        { @func getenv vars [ MILO_MODE ] default "direct" }
        { @func getenv vars [ MILO_EQUALIZER ] default "" }
    ]
}

pcm.milo_roc {
    @func concat
    strings [
        "pcm.milo_roc_"
        { @func getenv vars [ MILO_MODE ] default "direct" }
        { @func getenv vars [ MILO_EQUALIZER ] default "" }
    ]
}

pcm.milo_radio {
    @func concat
    strings [
        "pcm.milo_radio_"
        { @func getenv vars [ MILO_MODE ] default "direct" }
        { @func getenv vars [ MILO_EQUALIZER ] default "" }
    ]
}

pcm.milo_podcast {
    @func concat
    strings [
        "pcm.milo_podcast_"
        { @func getenv vars [ MILO_MODE ] default "direct" }
        { @func getenv vars [ MILO_EQUALIZER ] default "" }
    ]
}

# === Multiroom Mode (via snapcast) ===

pcm.milo_spotify_multiroom {
    type plug
    slave.pcm {
        type hw
        card 1
        device 0
        subdevice 2
    }
}

pcm.milo_bluetooth_multiroom {
    type plug
    slave.pcm {
        type hw
        card 1
        device 0
        subdevice 0
    }
}

pcm.milo_roc_multiroom {
    type plug
    slave.pcm {
        type hw
        card 1
        device 0
        subdevice 1
    }
}

pcm.milo_radio_multiroom {
    type plug
    slave.pcm {
        type hw
        card 1
        device 0
        subdevice 3
    }
}

pcm.milo_podcast_multiroom {
    type plug
    slave.pcm {
        type hw
        card 1
        device 0
        subdevice 4
    }
}

# === Multiroom Mode with DSP (via snapcast - DSP applied by snapclient) ===
# In multiroom_eq mode, audio goes to snapcast. DSP is applied locally by each client.

pcm.milo_spotify_multiroom_eq {
    type plug
    slave.pcm {
        type hw
        card 1
        device 0
        subdevice 2
    }
}

pcm.milo_bluetooth_multiroom_eq {
    type plug
    slave.pcm {
        type hw
        card 1
        device 0
        subdevice 0
    }
}

pcm.milo_roc_multiroom_eq {
    type plug
    slave.pcm {
        type hw
        card 1
        device 0
        subdevice 1
    }
}

pcm.milo_radio_multiroom_eq {
    type plug
    slave.pcm {
        type hw
        card 1
        device 0
        subdevice 3
    }
}

pcm.milo_podcast_multiroom_eq {
    type plug
    slave.pcm {
        type hw
        card 1
        device 0
        subdevice 4
    }
}

# === Direct Mode (to hardware) ===

pcm.milo_spotify_direct {
    type plug
    slave.pcm {
        type hw
        card sndrpihifiberry
        device 0
    }
}

pcm.milo_bluetooth_direct {
    type plug
    slave.pcm {
        type hw
        card sndrpihifiberry
        device 0
    }
}

pcm.milo_roc_direct {
    type plug
    slave.pcm {
        type hw
        card sndrpihifiberry
        device 0
    }
}

pcm.milo_radio_direct {
    type plug
    slave.pcm {
        type hw
        card sndrpihifiberry
        device 0
    }
}

pcm.milo_podcast_direct {
    type plug
    slave.pcm {
        type hw
        card sndrpihifiberry
        device 0
    }
}

# === Direct Mode with DSP (via CamillaDSP loopback) ===

pcm.milo_spotify_direct_eq {
    type plug
    slave.pcm "camilladsp"
}

pcm.milo_bluetooth_direct_eq {
    type plug
    slave.pcm "camilladsp"
}

pcm.milo_roc_direct_eq {
    type plug
    slave.pcm "camilladsp"
}

pcm.milo_radio_direct_eq {
    type plug
    slave.pcm "camilladsp"
}

pcm.milo_podcast_direct_eq {
    type plug
    slave.pcm "camilladsp"
}

# === CamillaDSP device ===
# Routes audio through Loopback device subdevice 5 for CamillaDSP processing
# CamillaDSP captures from hw:Loopback,1,5 and outputs to hw:sndrpihifiberry,0

pcm.camilladsp {
    type plug
    slave.pcm {
        type hw
        card Loopback
        device 0
        subdevice 5
    }
}

# === Snapclient DSP output ===
# Snapclient should output here when DSP is enabled for multiroom mode

pcm.snapclient_dsp {
    type plug
    slave.pcm {
        type hw
        card Loopback
        device 0
        subdevice 5
    }
}
